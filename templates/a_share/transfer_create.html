{% extends "base.html" %}
{% block meta_title %}Share files · HerbiesPlace{% endblock %}
{% block layout %}
<main class="max-w-3xl mx-auto px-4 py-10 space-y-6">
  <header>
    <p class="text-sm uppercase tracking-wide text-indigo-500 font-semibold">Share</p>
    <h1 class="text-3xl font-bold text-gray-900">Send files securely</h1>
    <p class="text-gray-600 mt-2 text-sm">
      Upload multiple files to a private location and send a time-limited access link with a 6‑digit security code.
    </p>
  </header>

  <form method="post" enctype="multipart/form-data" class="space-y-6 bg-white shadow rounded-xl p-6">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="space-y-1">
      <label class="text-sm font-medium text-gray-700">{{ form.recipient_email.label }}</label>
      {{ form.recipient_email }}
      {{ form.recipient_email.errors }}
    </div>

    <div class="space-y-1">
      <label class="text-sm font-medium text-gray-700">{{ form.title.label }}</label>
      {{ form.title }}
      {{ form.title.errors }}
    </div>

    <div class="space-y-1">
      <label class="text-sm font-medium text-gray-700">{{ form.message.label }}</label>
      {{ form.message }}
      {{ form.message.errors }}
    </div>

    <div class="space-y-2">
      <label class="text-sm font-medium text-gray-700">Files</label>
      <p class="text-xs text-gray-500">You can drag &amp; drop or select multiple files. The link will be valid for 5 days.</p>

      <label id="dropzone"
             for="id_files"
             class="relative flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors">
        <span id="file-pill"
              class="hidden absolute top-2 left-3 text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-800 border border-slate-300 shadow-sm">
          No files selected
        </span>
        <div class="flex flex-col items-center justify-center pt-5 pb-6 text-center pointer-events-none">
          <svg class="w-10 h-10 mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <p class="mb-1 text-sm text-gray-600">
            <span class="font-semibold">Click to upload</span> or drag and drop
          </p>
          <p id="file-count" class="text-xs text-gray-500">No files selected yet</p>
        </div>
        <input id="id_files"
               type="file"
               name="files"
               multiple
               class="sr-only" />
      </label>
      <p class="text-[11px] text-gray-500 mt-1">Maximum 10 MB per file (server limits may also apply).</p>
      {{ form.files.errors }}
    </div>

    <div class="flex gap-3">
      <button type="submit" class="button">Send files</button>
      <a href="{% url 'portfolio-mine' %}" class="button button-gray">Cancel</a>
    </div>
  </form>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('id_files');
    const fileCount = document.getElementById('file-count');
    const filePill = document.getElementById('file-pill');

    function updateFileCount(files) {
      if (!files || files.length === 0) {
        fileCount.textContent = 'No files selected yet';
        if (filePill) {
          filePill.classList.add('hidden');
          filePill.textContent = 'No files selected';
        }
        return;
      }
      const label = `${files.length} file${files.length !== 1 ? 's' : ''} selected`;
      fileCount.textContent = label;
      if (filePill) {
        filePill.textContent = label;
        filePill.classList.remove('hidden');
      }
    }

    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('bg-gray-100');
    });

    dropzone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      dropzone.classList.remove('bg-gray-100');
    });

    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('bg-gray-100');
      const dt = e.dataTransfer;
      if (!dt || !dt.files || !dt.files.length) return;
      fileInput.files = dt.files;
      updateFileCount(fileInput.files);
    });

    fileInput.addEventListener('change', (e) => {
      updateFileCount(e.target.files);
    });
  });
  </script>
</main>
{% endblock %}

